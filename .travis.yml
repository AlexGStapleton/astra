sudo: false

language: php
dist: precise

services:
  - docker

notifications:
  email:
    on_success: never
    on_failure: change
  slack: bsf-bots:RDGCoMDDxnlCvnUfvhq8pQ36

cache:
  - $HOME/.composer/cache

matrix:
  include:
    - php: 7.2
      env: WP_TRAVISCI=phpcs
      env: WP_URL=http://localhost:8000/

before_script:
  #- |
  #  if [[ "$WP_TRAVISCI" == "phpcs" ]] ; then
      # composer install
   # fi

script:
  #- |
    #if [[ "$WP_TRAVISCI" == "phpcs" ]] ; then
      # vendor/bin/phpcs
    #fi
  # - if find . -name "*.php" ! -path "./vendor/*" ! -path "./admin/bsf-core/*" -exec php -l {} \; | grep "Errors parsing"; then exit 1; fi
  # Setup e2e enviornment
  - docker-compose up -d
  - docker-compose run --rm cli core config --dbname=wordpress --dbuser=wordpress --dbpass=wordpress 
  - docker-compose run --rm cli db create
  - docker-compose run --rm cli core install --title='Astra e2e' --admin_user='admin' --admin_password='password' --admin_email=test@astra.dev --url="$WP_URL"
  - docker-compose run --rm cli option get home
  